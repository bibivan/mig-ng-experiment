<app-form-progress></app-form-progress>
<app-container>
    <app-form-wrapper>
        <app-calculator [defaultValue]="{ sum: order.sum, term: order.term }"></app-calculator>

        <div class="form-divider"></div>

        <h2 class="font-weight-bold">Заполните анкету</h2>

        <form appInvalidControlFocus [formGroup]="form" (ngSubmit)="submit()">
            <app-input [formControl]="mobilePhoneControl"
                       placeholder="Мобильный телефон"
                       mask="phone"
                       [mandatory]="true"
                       [errorMessage]="mobilePhoneControl.errors | errorMessage"
                       class="no-margin-bottom"
                       (blurEvent)="checkPhone($event)"
            ></app-input>

            <p class="text-4 margin-top-x1">
                Обращаем внимание, что на этот номер будут отправлены подтверждающие SMS.
                Ваш номер также является логином для входа в личный кабинет.
            </p>

            <app-input [formControl]="lastnameControl"
                       placeholder="Фамилия"
                       [mandatory]="true"
                       [errorMessage]="lastnameControl.errors | errorMessage"
            ></app-input>

            <app-input [formControl]="nameControl"
                       placeholder="Имя"
                       [mandatory]="true"
                       [errorMessage]="nameControl.errors | errorMessage"
            ></app-input>

            <p class="text-3 color-dangerous margin-bottom-x2"
               [class.hide]="true"
            >
                Проверьте, пожалуйста, еще раз имя, если данные верны, то продолжите заполнение анкеты.
            </p>

            <app-input [formControl]="patronymicControl"
                       placeholder="Отчество"
                       [mandatory]="true"
                       [errorMessage]="patronymicControl.errors | errorMessage"
            ></app-input>

            <p class="text-3 color-dangerous"
               [class.hide]="true"
            >
                Проверьте, пожалуйста, еще раз введенные фамилию, имя и отчество,
                если данные верны, то продолжите заполнение анкеты.
            </p>

            <app-input [formControl]="emailControl"
                       placeholder="Электронная почта"
                       [mandatory]="true"
                       [errorMessage]="emailControl.errors | errorMessage"
                       class="no-margin-bottom"
            ></app-input>
            <p class="text-4 margin-top-x1">
                E-mail необходим для получения договора и документов об оплате.
            </p>

            <app-input [formControl]="dateBirthdayControl"
                       mask="date"
                       placeholder="Дата рождения"
                       [mandatory]="true"
                       [errorMessage]="dateBirthdayControl.errors | errorMessage"
            ></app-input>

            <app-input-checkbox [formControl]="acceptControl">
                Я соглашаюсь на
                <span class="link">обработку персональных данных и данных об абонентах</span>
            </app-input-checkbox>

            <app-input-checkbox [formControl]="cessionAllowedControl">
                Я соглашаюсь на уступку кредитором третьим лицам прав (требований) по договору займа.
            </app-input-checkbox>

            <app-input-checkbox [formControl]="bankruptControl">
                Я подтверждаю, что в настоящий момент не являюсь ответчиком в каком-либо судебном разбирательстве и не
                был в
                течение
                последних 5 лет признан банкротом
            </app-input-checkbox>

            <div class="form-divider margin-bottom-x2"></div>

            <app-button type="submit"
                        theme="primary"
                        [disabled]="!isAvailableSubmit"
            >Продолжить
            </app-button>

        </form>
    </app-form-wrapper>
</app-container>

<app-modal *ngIf="isOpenModalCheckPhone"
           [bottomMobile]="true"
           [small]="true"
           [centered]="true"
>
    <div class="text-align-center">
        <ng-container *ngIf="templateModalCheckPhone !== 'error'; else errorTemplate">
            <div [ngSwitch]="templateModalCheckPhone">
                <div *ngSwitchCase="'activeCurrentAccount'">
                    <p class="h1">Найдена незавершенная заявка</p>
                    <p class="text-2 color-gray">
                         Войдите, пожалуйста, в личный кабинет или скорректируйте введенные данные
                    </p>
                </div>
                <div *ngSwitchCase="'unfinishedApplication'">
                    <p class="h1">Найдена учетная запись</p>
                    <p class="text-2 color-gray">Войдите, пожалуйста, в личный кабинет или скорректируйте введенные данные</p>
                </div>
                <div *ngSwitchCase="'promotions'">
                    <p class="h1">Найдена учетная запись</p>
                    <p class="text-2 color-gray">В Личном кабинете для Вас сформировано персональное предложение</p>
                </div>
            </div>

            <div class="edit-phone margin-top-x2" (click)="closeModalCheckPhone()">
                <app-input [formControl]="mobilePhoneControl"
                           placeholder="Номер телефона"
                           mask="phone"
                           [readonly]="true"
                ></app-input>

                <div class="icon">
                    <app-icon name="edit"></app-icon>
                </div>
            </div>
            <div class="margin-top-x2">
                <app-button (clicked)="onClickAuthButton()">Войти в личный кабинет</app-button>
            </div>
            <div class="margin-top-x2">
                <app-button-text (clicked)="closeModalCheckPhone()">Изменить номер телефона</app-button-text>
            </div>
        </ng-container>

        <ng-template #errorTemplate>
            <p class="h1">Ошибка</p>
            <p class="text-2 color-gray">Ошибка проверки номера телефона, повторите ввод</p>
            <app-button-text (clicked)="closeModalCheckPhone()">Повторить ввод</app-button-text>
        </ng-template>
    </div>


</app-modal>
